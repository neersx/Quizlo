<app-page-header firstTitle="Tests" title="My Tests History" title1="My Tests List"
    activeTitle="My Tests History"></app-page-header>

<div *ngIf="loading" class="header text-center">
    <h5 style="text-align: center;">Loading Your Tests...</h5>
    <app-test-skeleton-loader [displayFooter]="false" [displayProgress]="true" [totalQuestions]="0">
    </app-test-skeleton-loader>
</div>

<div *ngIf="!loading" class="row">

    @for (alert of usageAlerts; track alert; let i = $index) {
    <div class="col-12 mb-3">
        <spk-alerts [variant]="alert.type" [isDismissible]="true" (close)="customizedAlertclose(i)">
            <span [innerHTML]="getSanitizedSVG(alert.icon)"></span>
            {{alert.message}}
            <button type="button" class="btn-close" (close)="customizedAlertclose(i)" data-bs-dismiss="alert"
                aria-label="Close">
                <i class="bi bi-x"></i>
            </button>
        </spk-alerts>
    </div>
    }

    <div *ngIf="!loading && tests.length === 0" class="text-center">
        <p>No tests found.</p>
    </div>

    <div *ngIf="!loading && tests.length > 0" class="row justify-content-center">

        @for (test of tests; track $index) {
        <div class="col-xl-4">
            <div class="card custom-card">
                <div class="card-body">
                    <div class="float-end">
                        <a [routerLink]="['/test', 'test-result', test.id]"
                            class="avatar avatar-rounded bg-primary avatar-sm" data-bs-toggle="tooltip"
                            data-bs-placement="top" aria-label="Add to Wishlist" ngbTooltip="Open Test Details">
                            <span><i class="bi bi-play"></i></span> 
                        </a>
                    </div>
                    <div class="d-flex align-items-center flex-wrap gap-2">
                        <span class="avatar avatar-xl border border-dashed avatar-rounded">
                            <img [src]="'../assets/images/exams/icons/' + test.examCode + '.png'"
                                (error)="onIconError($event)" [alt]="test.title">
                        </span>
                        <div class="ms-2 mt-2">
                            <h6 class="fw-medium mb-1 d-flex align-items-center">
                                <a [routerLink]="['/test', 'test-result', test.id]">{{ test.title }} </a>
                            </h6>
                            <div class="d-flex gap-2 mb-3 flex-wrap">
                                <a href="javascript:void(0);"><i class="ri-chat-2-line text-info"></i> {{ test.language }} </a>
                                <p class="mb-0 text-muted">Date taken - {{ test.createdAt | date: 'dd-MMM-yyyy hh:mm' }}
                                </p>
                            </div>
                            <div class="d-flex align-items-center mb-2 fs-12 text-muted flex-wrap">
                                <p class="fs-12 mb-0">Your Score : </p>
                                <a href="javascript:void(0);" class="ms-1 min-w-fit-content text-muted">
                                    <span> {{test.marksScored}} / {{ test.totalMarks }}</span>
                                </a>
                            </div>
                            <div class="d-flex gap-1 align-items-center flex-wrap">
                                <a href="javascript:void(0);"
                                    class="badge badge-md fs-11 rounded-pill bg-primary-transparent me-1">
                                    <i class="bi bi-people me-1"></i>No. of Questions : {{ test.totalQuestions }}
                                </a>
                                <a href="javascript:void(0);" class="badge badge-md fs-11 rounded-pill"
                                    [ngClass]="getStatusClass(test.status)">
                                    <i class="bi bi-briefcase me-1"></i>Status : {{ test.status }}
                                </a>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- <div class="card-footer">
                <div class="d-grid">
                  <a href="javascript:void(0);" class="btn btn-wave btn-primary">
                    View Details <i class="ri-arrow-right-line align-middle rtl-transform-icon"></i>
                  </a>
                </div>
              </div> -->
            </div>
        </div>
        }
    </div>
</div>